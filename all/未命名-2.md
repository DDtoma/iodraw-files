```mermaid
classDiagram
    %% 枚举类型
    class MemoryType {
        <<enumeration>>
        EPISODIC
        SEMANTIC
        PROCEDURAL
        WORKING
    }
    
    %% 消息接口（简化版）
    class IMemoryMessage {
        <<interface>>
        +get_id() str
        +get_timestamp() float
        +get_agent_instance_id() str
        +get_content() Any
        +get_metadata() Dict
    }
    
    %% 抽象接口定义
    class IMemoryManager {
        <<interface>>
        +store_message(message: IMemoryMessage) memory_id
        +retrieve_message(agent_instance_id, memory_type, memory_id) IMemoryMessage
        +query_messages(agent_instance_id, query) IMemoryMessage[]
    }
    
    class IMemoryStore {
        <<interface>>
        +save(message: IMemoryMessage) memory_id
        +load(agent_instance_id, memory_type, memory_id) IMemoryMessage
        +batch_load(agent_instance_id, memory_ids) IMemoryMessage[]
    }
    
    class IMemoryIndexer {
        <<interface>>
        +index_message(message: IMemoryMessage) void
        +search(agent_instance_id, query) memory_ids[]
    }
    
    class IMemoryPolicy {
        <<interface>>
        +evaluate_async(message: IMemoryMessage) void
    }
    
    class IPersistentAdapter {
        <<interface>>
        +save(key, message) void
        +load(key) message
    }
    
    %% 抽象基类实现
    class AbstractMemoryManager {
        <<abstract>>
        #_store: IMemoryStore
        #_indexer: IMemoryIndexer
        #_policy: IMemoryPolicy
        +store_message(message: IMemoryMessage)* memory_id
        +retrieve_message(agent_instance_id, memory_type, memory_id)* IMemoryMessage
        +query_messages(agent_instance_id, query)* IMemoryMessage[]
        #_validate_access(agent_instance_id) void
        #_extract_memory_type(message) MemoryType
    }
    
    class AbstractMemoryStore {
        <<abstract>>
        #_cache: Dict
        #_persistent_storage: IPersistentAdapter
        +save(message: IMemoryMessage)* memory_id
        +load(agent_instance_id, memory_type, memory_id)* IMemoryMessage
        +batch_load(agent_instance_id, memory_ids)* IMemoryMessage[]
        #_generate_id() string
        #_extract_type(memory_id) MemoryType
        #_persist_async(message: IMemoryMessage) void
    }
    
    class AbstractMemoryIndexer {
        <<abstract>>
        #_store: IMemoryStore
        #_time_index: Dict
        #_content_index: Dict
        +index_message(message: IMemoryMessage)* void
        +search(agent_instance_id, query)* memory_ids[]
        #_add_to_time_index(agent_instance_id, timestamp, memory_id) void
        #_index_by_type(message: IMemoryMessage) void
        #_extract_keywords(content) keywords[]
        #_search_by_time_range(agent_instance_id, start_time, end_time) memory_ids[]
        #_search_by_keywords(agent_instance_id, keywords) memory_ids[]
    }
    
    class AbstractMemoryPolicy {
        <<abstract>>
        #_store: IMemoryStore
        #_indexer: IMemoryIndexer
        #_importance_scores: Dict
        +evaluate_async(message: IMemoryMessage)* void
        #_manage_working_memory_capacity(agent_instance_id) void
        #_consolidate_episodic_memories(agent_instance_id) void
        #_apply_forgetting_strategy(agent_instance_id) void
        #_forget_low_importance_memories(agent_instance_id) void
        #_calculate_importance(message: IMemoryMessage) float
    }
    
    %% 具体实现类
    class DefaultMemoryManager {
        +store_message(message: IMemoryMessage) memory_id
        +retrieve_message(agent_instance_id, memory_type, memory_id) IMemoryMessage
        +query_messages(agent_instance_id, query) IMemoryMessage[]
    }
    
    class DefaultMemoryStore {
        +save(message: IMemoryMessage) memory_id
        +load(agent_instance_id, memory_type, memory_id) IMemoryMessage
        +batch_load(agent_instance_id, memory_ids) IMemoryMessage[]
    }
    
    class DefaultMemoryIndexer {
        +index_message(message: IMemoryMessage) void
        +search(agent_instance_id, query) memory_ids[]
    }
    
    class DefaultMemoryPolicy {
        +evaluate_async(message: IMemoryMessage) void
    }
    
    class FilePersistentAdapter {
        +save(key, message) void
        +load(key) message
    }
    
    %% 关系定义 - 接口实现与继承
    IMemoryManager <|.. AbstractMemoryManager : 实现
    IMemoryStore <|.. AbstractMemoryStore : 实现
    IMemoryIndexer <|.. AbstractMemoryIndexer : 实现
    IMemoryPolicy <|.. AbstractMemoryPolicy : 实现
    IPersistentAdapter <|.. FilePersistentAdapter : 实现
    
    AbstractMemoryManager <|-- DefaultMemoryManager : 继承
    AbstractMemoryStore <|-- DefaultMemoryStore : 继承
    AbstractMemoryIndexer <|-- DefaultMemoryIndexer : 继承
    AbstractMemoryPolicy <|-- DefaultMemoryPolicy : 继承
    
    %% 依赖关系
    AbstractMemoryManager --> IMemoryStore : 依赖
    AbstractMemoryManager --> IMemoryIndexer : 依赖
    AbstractMemoryManager --> IMemoryPolicy : 依赖
    AbstractMemoryIndexer --> IMemoryStore : 依赖
    AbstractMemoryPolicy --> IMemoryStore : 依赖
    AbstractMemoryPolicy --> IMemoryIndexer : 依赖
    AbstractMemoryStore --> IPersistentAdapter : 依赖
    
    %% 消息关系
    AbstractMemoryManager --> IMemoryMessage : 操作
    AbstractMemoryStore --> IMemoryMessage : 存储
    AbstractMemoryIndexer --> IMemoryMessage : 索引
    AbstractMemoryPolicy --> IMemoryMessage : 评估
```