```mermaid
graph TB
    %% 总标题
    title[<b>Agent通信与协作架构</b>]
    
    %% Agent实例
    subgraph Agents["Agent实例"]
        Agent1["Agent 1"]
        Agent2["Agent 2"]
        Agent3["Agent 3"]
    end
    
    %% 通信层
    subgraph CommunicationLayer["通信层"]
        MessageBus["消息总线<br>Message Bus"]
        Protocol["通信协议<br>Communication Protocol"]
        Channel["通信渠道<br>Communication Channels"]
    end
    
    %% 协作层
    subgraph CollaborationLayer["协作层"]
        Coordinator["协作协调器<br>Collaboration Coordinator"]
        RoleManager["角色管理器<br>Role Manager"]
        TeamFormation["团队形成器<br>Team Formation"]
        StateSync["状态同步器<br>State Synchronizer"]
    end
    
    %% 服务发现
    subgraph DiscoveryService["服务发现"]
        Registry["Agent注册表<br>Agent Registry"]
        CapabilityIndex["能力索引<br>Capability Index"]
        HealthMonitor["健康监控<br>Health Monitor"]
    end
    
    %% 协作模型
    subgraph CollaborationModels["协作模型"]
        Orchestration["集中式编排<br>Orchestration"]
        Choreography["分布式编排<br>Choreography"]
        HybridCol["混合协作<br>Hybrid Collaboration"]
    end
    
    %% 关系连接
    Agent1 -.-> MessageBus
    Agent2 -.-> MessageBus
    Agent3 -.-> MessageBus
    
    MessageBus --> Protocol
    Protocol --> Channel
    
    Agents --> Registry["]
    Registry --> CapabilityIndex
    CapabilityIndex --> Coordinator
    
    CollaborationModels --> CollaborationLayer
    
    Coordinator --> RoleManager
    Coordinator --> TeamFormation
    Coordinator --> StateSync
    
    %% 样式设置
    classDef titleClass fill:#f9f9f9,stroke:#333,stroke-width:2px,font-weight:bold
    classDef agentClass fill:#e3f2fd,stroke:#1565c0,stroke-width:1px
    classDef commClass fill:#e8f5e9,stroke:#2e7d32,stroke-width:1px
    classDef collabClass fill:#fff3e0,stroke:#e65100,stroke-width:1px
    classDef discoveryClass fill:#f3e5f5,stroke:#7b1fa2,stroke-width:1px
    classDef modelClass fill:#e1f5fe,stroke:#0288d1,stroke-width:1px
    
    class title titleClass
    class Agent1,Agent2,Agent3 agentClass
    class MessageBus,Protocol,Channel commClass
    class Coordinator,RoleManager,TeamFormation,StateSync collabClass
    class Registry,CapabilityIndex,HealthMonitor discoveryClass
    class Orchestration,Choreography,HybridCol modelClass
```